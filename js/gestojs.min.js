(function(){var b=function(d,a){var c=this,f=new b.core.GestureList,e={},k,i,g=function(a){var b;if(e[a.type])for(b=0;b<e[a.type].length;b++)e[a.type][b].call(c,a)};this.enabled=!0;this.addGesture=function(a,c,e){b.log("Listening gesture ",a);f.add(new b.core.Gesture(a,c||b.gesture[a]),e)};this.removeGesture=function(a){f.remove(a)};this.addEventListener=function(a,b){e[a]||(e[a]=[]);e[a].push(b)};this.removeEventListener=function(a,b){var c;if(e[a]){for(c=0;c<e[a].length;c++)e[a][c]!==b&&(void 0).push(e[a][c]);
e[a]=void 0}};var h;k=new b.core.Tracker(d||window);k.addListener(b.event.ON_TRACK_START,g);k.addListener(b.event.ON_TRACK_COMPLETE,g);k.addListener(b.event.ON_TRACK_PROGRESS,g);k.addListener(b.event.ON_TRACK_COMPLETE,g);k.addListener(b.event.ON_TRACK_PROGRESS,function(a){var c=new b.event.Event(b.event.ON_PROGRESS);c.tracks=a.tracks;c.analyzer=i;g(c)});k.addListener(b.event.ON_TRACK_COMPLETE,function(a){var e;if(c.enabled&&(a=i.analyze(a.tracks,f))&&a.length)e=new b.event.Event(b.event.ON_GESTURE),
e.gestures=a,g(e)});i=new b.core.Analyzer;if(a)for(h in b.gesture)c.addGesture(h)};b.core={};b.util={};b.event={};b.analyzer={};b.gesture={};b.NAME="GestoJS";b.debug=1;b.err=function(d){var a=["["+b.NAME+"]"],c=0;if(b.debug&&b.util.isFunction(window.console.error)){for(;c<arguments.length;c++)a.push(arguments[c]);window.console.error.call(window.console,a.join(" "))}};b.log=function(){var d=["["+b.NAME+"]"],a=0;if(b.debug&&b.util.isFunction(window.console.log)){for(;a<arguments.length;a++)d.push(arguments[a]);
window.console.log.call(window.console,d.join(" "))}};b.warn=function(d){var a=["["+b.NAME+"]"],c=0;if(b.debug&&typeof b.util.isFunction(window.console)){for(;c<arguments.length;c++)a.push(arguments[c]);window.console.warn.call(window.console,a.join(" "))}};window.GestoJS=b})();(function(b){b.util={isTouchableDevice:function(){return-1<navigator.userAgent.indexOf("Chrome")&&!(-1<navigator.userAgent.indexOf("iOS")||-1<navigator.userAgent.indexOf("Android"))?!1:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch},isFunction:function(b){return"function"===typeof b}}})(window.GestoJS);(function(b){b.core.Analyzer=function(){var d={},a=function(a){for(var b=[],e=[],d,i,g=-1,h=0,l;h<a.length;h++){i=a[h].startTime;d=[];for(l=0;l<e.length;l++)i<e[l].endTime&&d.push(e[l]);e=d;e.length||(g++,b[g]={time:i,tracks:[]});b[g].tracks.push(a[h]);e.push(a[h])}return b};this.analyze=function(c,f){var e,d=/[a-z0-9]+\([^\)]*\)/gi,i=[],g=a(c),h,l,m,q,n,o,s,r,j,t=f.getSorted(),p,u;p=0;for(u=t.length;p<u;p++)if(n=t[p].gestureData,n.length===g.length){for(h=l=0;h<n.length;h++)if(o=n[h],o=o.split(/&&/g),
m=o.length,r=g[h].tracks.length,r!==m)l=0;else{for(j=m=0;j<r;j++){s=0;e={tracks:c,steps:g,step:g[h],track:g[h].tracks[j]};o[j]=o[j].replace(d,function(a){var c,f;try{c=a.match(/^([^\(]+)/)[1],f=a.match(/\(([^\)]*)/)[1].split(",")}catch(d){return b.err('Parsing error in "'+a+'": '+d.toString()),0}if(!b.analyzer[c])return b.err('Undefined analyzer "'+c+'"'),0;a=g[h].tracks[j].analyze(c,[e].concat(f));s++;return a});if(!(q=eval(o[j]))){m=0;break}m+=q/s}if(!m){l=0;break}l+=m/r}l&&i.push({name:t[p].name,
points:l/n.length})}return i.length?(i.sort(function(a,b){return a.points>b.points?1:a.points<b.points?-1:0}),i):null};this.addListener=function(a,b){d[a]||(d[a]=[]);d[a].push({t:(new Date).getTime(),f:b})};this.removeListener=function(a,b){var e;if(b)for(e=0;e<d[a];e++)d[a][e].f===b&&d[a].splice(e,1);else delete d[a]}}})(window.GestoJS);(function(b){b.core.Gesture=function(b,a,c){this.name=b;this.priority=c||0;this.gestureData=[];"string"===typeof a&&this.gestureData.push(a);a instanceof Array&&(this.gestureData=a)}})(window.GestoJS);(function(b){b.core.Track=function(d){var a=this,c=0,f=0,e=null,k=null,i=0,g=Math.PI/2,h=2*Math.PI;this.id=d;this.points=[];this.startTime=(new Date).getTime();this.endTime=null;this.endAngle=this.startAngle=this.absoluteRotation=this.rotation=this.length=this.endSpeed=this.speed=this.duration=0;this.middle=this.offset=null;this.loops=0;this.push=function(b){this.points.push(b);var d,b=1<a.points.length?a.points[Math.max(0,a.points.length-2)]:null;d=a.points[a.points.length-1];a.speed=1E3*(a.length/
a.duration);a.offset=a.getOffset();c+=d.x;f+=d.y;a.middle=a.getMiddle();b&&(a.length+=d.distanceTo(b),d=d.angleTo(b),k>g&&d<-g&&i++,k<-g&&d>g&&i--,b=d+i*h,null!==e&&(a.rotation+=b-e,a.absoluteRotation+=Math.abs(b-e)),e=b,k=d,a.loops=Math.floor(a.rotation/h)+(0>a.rotation?1:0),a.endAngle=a.getAngle(Math.max(0,a.points.length-4),a.points.length-1),a.startAngle=a.getAngle(0,Math.min(a.points.length-1,3)),a.endSpeed=a.getSpeed())};this.end=function(){this.endTime||(this.endTime=(new Date).getTime(),this.duration=
this.endTime-this.startTime)};this.getOffset=function(){return new b.core.Point(this.points[this.points.length-1].x-this.points[0].x,this.points[this.points.length-1].y-this.points[0].y)};this.getMiddle=function(){return new b.core.Point(c/this.points.length,f/this.points.length)};this.getAngle=function(a,b){a=void 0!==a?a:this.points.length-3;b=void 0!==b?b:this.points.length-1;return this.points[b].angleTo(this.points[a])};this.getSpeed=function(){return this.points[this.points.length-1].distanceTo(this.points[Math.max(0,
this.points.length-2)])/(this.points[this.points.length-1].time-this.points[Math.max(0,this.points.length-2)].time)/1E3};this.analyze=function(a,c){return b.analyzer[a].apply(this,c)}}})(window.GestoJS);(function(b){var d={ON_GESTURE:"onGesture",ON_PROGRESS:"onProgress",ON_TRACK_PROGRESS:"onTrackProgress",ON_TRACK_START:"onTrackStart",ON_TRACK_COMPLETE:"onTrackComplete",Event:function(a){this.timestamp=(new Date).getTime();this.type=a;this.analyzer=this.tracks=this.gestures=this.originalEvent=null}};d.Event.prototype.analyzeGesture=function(a){var c;if(!this.analyzer)return null;a instanceof b.core.GestureList?c=a:(c=new b.core.GestureList,c.add(a));return this.analyzer.analyze(this.tracks,c)};b.event=
d})(window.GestoJS);(function(b){b.core.Point=function(d,a,c,f){this.time=(new Date).getTime();this.x=d;this.y=a;this.size=c||1;this.force=f||1;this.distanceTo=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};this.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)};this.angle=function(){return(new b.core.Point(0,0)).angleTo(this)};this.invert=function(){return new b.core.Point(-this.x,-this.y,c,f)}}})(window.GestoJS);(function(b){b.core.Tracker=function(d){var a=this,c={},f=[],e={},k=0,i=b.util.isTouchableDevice(),g,h=function(a){var c=0,d,h;a.preventDefault();g&&(clearTimeout(g),g=null);f.length||(n(b.event.ON_TRACK_START,{originalEvent:a}),h=!0);if(i)for(;c<a.touches.length;c++)d=a.touches[c],void 0===e[d.identifier]&&(e[d.identifier]=k++,f[e[d.identifier]]=new b.core.Track(d.identifier),f[e[d.identifier]].push(new b.core.Point(d.pageX,d.pageY)));else f.push(new b.core.Track(f.length)),f[f.length-1].push(new b.core.Point(a.pageX,
a.pageY));h||n(b.event.ON_TRACK_PROGRESS,{tracks:f,originalEvent:a})},l=function(a){var c=0,d;if(f.length&&!g){a.preventDefault();if(i)for(;c<a.touches.length;c++)d=a.touches[c],f[e[d.identifier]]?f[e[d.identifier]].push(new b.core.Point(d.pageX,d.pageY)):b.err("Fixme! Attemp to move unstarted touch !?");else f[f.length-1].push(new b.core.Point(a.pageX,a.pageY));n(b.event.ON_TRACK_PROGRESS,{tracks:f,originalEvent:a})}},m=function(c){var d={},j=0;if(f.length){c.preventDefault();if(!i||!c.touches.length)g=
setTimeout(q,a.endGestureDelay);if(i){for(;j<c.touches.length;j++)d[c.touches[j].identifier]=!0;for(j=0;j<f.length;j++)d[e[f[j].id]]||(f[j].end(),delete e[f[j].id]);n(b.event.ON_TRACK_PROGRESS,{tracks:f,originalEvent:c})}else for(j=0;j<f.length;j++)f[j].end()}},q=function(){f.sort(function(a,b){return a.startTime>b.startTime?1:a.startTime<b.startTime?-1:0});n(b.event.ON_TRACK_COMPLETE,{tracks:f,originalEvent:null});f=[];e={};k=0;g=null},n=function(a,d){var f=0,e;if(c[a]){e=new b.event.Event(a);e.tracks=
d.tracks;for(e.originalEvent=d.originalEvent;f<c[a].length;f++)c[a][f].method.call(this,e)}};this.endGestureDelay=120;this.addListener=function(a,b){c[a]||(c[a]=[]);c[a].push({method:b})};this.removeListener=function(a,b){var d;if(b)for(d=0;d<c[a];d++)c[a][d].method===b&&c[a].splice(d,1);else delete c[a]};try{i?(d.addEventListener("touchstart",h,!1),window.addEventListener("touchmove",l,!1),window.addEventListener("touchend",m,!1)):(d.addEventListener("mousedown",h,!1),window.addEventListener("mousemove",
l,!1),window.addEventListener("mouseup",m,!1))}catch(o){b.err(o.toString(),o)}}})(window.GestoJS);(function(b){var d=function(){this.list={}};d.prototype.add=function(a,c){var d,e;a instanceof b.core.Gesture&&(a.priority=c||a.priority||0,this.list[a.name]=a);"string"===typeof a&&(a=a.split(","));if(a instanceof Array){d=0;for(e=a.length;d<e;d++)a[d]instanceof b.core.Gesture?(a[d].priority=c||a[d].priority||0,this.list[a[d].name]=a[d]):"string"===typeof a[d]&&b.gesture[a[d]]?this.list[a[d]]=new b.core.Gesture(a[d],b.gesture[a],c):this.list["gesture"+(d+1)]=new b.core.Gesture("gesture"+(d+1),a[d].toString(),
c)}};d.prototype.remove=function(a){delete this.list[a]};d.prototype.getSorted=function(){var a=[],b;for(b in this.list)a.push(this.list[b]);a.sort(function(a,b){return a.priority>b.priority?1:b.priority>a.priority?-1:0});return a};b.core.GestureList=d})(window.GestoJS);(function(b){b.analyzer.press=function(){return 1};b.analyzer.tap=function(b,a,c){a=parseInt(a,10)||0;c=parseInt(c,10)||400;return 5>this.length&&this.duration>=a&&this.duration<c?1:0};b.analyzer.longTap=function(b,a){a=parseInt(a,10)||400;return 5>this.length&&this.duration>=a?1:0}})(window.GestoJS);(function(b){b.analyzer.pinch=function(b,a,c){var f,e,k,i,g;if(2!==b.step.tracks.length)return 0;c=parseFloat(c)/180*Math.PI||Math.PI/4;a=parseInt(a,10);f=b.step.tracks[this===b.step.tracks[0]?1:0];b=this.points[0].angleTo(f.points[0]);e=this.points[this.points.length-1].angleTo(f.points[f.points.length-1]);k=this.points[0].distanceTo(f.points[0]);i=this.points[this.points.length-1].distanceTo(f.points[f.points.length-1]);g=this.offset.angle();f=f.offset.angle();return Math.abs(Math.sin(g)+Math.sin(f))<
Math.PI/4&&Math.abs(Math.cos(g)+Math.cos(f))<Math.PI/4&&k*a>i*a&&Math.abs(b-e)<=c?1:0}})(window.GestoJS);(function(b){b.analyzer.arc=function(b,a,c){a=parseFloat(a)/180*Math.PI;c=parseFloat(c)/180*Math.PI||Math.PI/6;return this.rotation>=a-c&&this.rotation<=a+c&&20<this.length?1-Math.abs(a-this.rotation)/(2*c):0};b.analyzer.circle=function(b,a){var c,f,e=0,k=Number.MAX_VALUE,a=a||0.8;c=0;for(f=this.points.length;c<f;c++)e=Math.max(e,this.points[c].distanceTo(this.middle)),k=Math.min(k,this.points[c].distanceTo(this.middle));return Math.max(0,a-(e-k)/e)};b.analyzer.loop=function(b){return Math.abs(this.loops)===
(b||1)?1:0}})(window.GestoJS);(function(b){b.analyzer.line=function(b,a,c){a=parseFloat(a)/180*Math.PI;c=parseFloat(c)/180*Math.PI||Math.PI/6;return this.absoluteRotation<Math.PI/2&&5<this.length&&(this.endAngle>=a-c&&this.endAngle<=a+c||this.endAngle+2*Math.PI>=a-c&&this.endAngle+2*Math.PI<=a+c)?1-Math.abs(a-this.endAngle)/(2*c):0}})(window.GestoJS);(function(b){b.gesture.tap=["tap()"];b.gesture.twoTap=["tap()","tap()"];b.gesture.longTap=["longTap()"];b.gesture.twoTapLong=["tap()","longTap()"];b.gesture.doubleTap=["tap() && tap()"];b.gesture.doubleLongTap=["longTap() && longTap()"];b.gesture.twoDoubleTap=["tap() && tap()","tap() && tap()"];b.gesture.swipeLeft=["line(0)"];b.gesture.swipeRight=["line(180)"];b.gesture.swipeUp=["line(90)"];b.gesture.swipeDown=["line(-90)"];b.gesture.doubleSwipeLeft=["line(0) && line(0)"];b.gesture.doubleSwipeRight=
["line(180) && line(180)"];b.gesture.doubleSwipeUp=["line(90) && line(90)"];b.gesture.doubleSwipeDown=["line(-90) && line(-90)"];b.gesture.zoomIn=["pinch(-1) && pinch(-1)"];b.gesture.zoomOut=["pinch(1) && pinch(1)"];b.gesture.circle=["arc(400,90) * circle() || arc(-400,90) * circle()"];b.gesture.circleRight=["arc(400,90) * circle()"];b.gesture.circleLeft=["arc(-400,90) * circle()"]})(window.GestoJS);GestoJS.debug=0;
