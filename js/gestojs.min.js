(function(){var b=function(f,a){var c=this,d=new b.core.GestureList,e,h;this.enabled=!0;this.addGesture=function(a,c,h){b.log("Listening gesture ",a);d.add(new b.core.Gesture(a,c||b.gesture[a]),h)};this.removeGesture=function(a){d.remove(a)};this.__getTracks=function(){return e.getTracks()};this.__getAnalyzer=function(){return h};var j=new b.events.EventDispatcher;this.addEventListener=j.addEventListener;this.removeEventListener=j.removeEventListener;this.dispatch=j.dispatch;var i;e=new b.core.Tracker(c,
f||window);e.addEventListener(b.events.ON_TRACK_START,c.dispatch);e.addEventListener(b.events.ON_TRACK_COMPLETE,c.dispatch);e.addEventListener(b.events.ON_TRACK_PROGRESS,c.dispatch);e.addEventListener(b.events.ON_TRACK_PROGRESS,function(a){var d=new b.events.Event(b.events.ON_PROGRESS);d.instance=c;d.sessionData=a.sessionData;d.tracks=a.tracks;d.activeTracks=a.activeTracks;d.analyzer=h;c.dispatch(d)});e.addEventListener(b.events.ON_TRACK_COMPLETE,function(a){var f,e;if(c.enabled&&(f=h.analyze(a.tracks,
d))&&f.length)e=new b.events.Event(b.events.ON_GESTURE),e.instance=c,e.sessionData=a.sessionData,e.gestures=f,c.dispatch(e)});h=new b.core.Analyzer(c);if(a)for(i in b.gesture)c.addGesture(i)};b.core={};b.util={};b.events={};b.analyzer={};b.gesture={};b.NAME="GestoJS";b.debug=1;b.err=function(f){var a=["["+b.NAME+"]"],c=0;if(b.debug&&b.util.isFunction(window.console.error)){for(;c<arguments.length;c++)a.push(arguments[c]);window.console.error.call(window.console,a.join(" "))}};b.log=function(){var f=
["["+b.NAME+"]"],a=0;if(b.debug&&b.util.isFunction(window.console.log)){for(;a<arguments.length;a++)f.push(arguments[a]);window.console.log.call(window.console,f.join(" "))}};b.warn=function(f){var a=["["+b.NAME+"]"],c=0;if(b.debug&&typeof b.util.isFunction(window.console)){for(;c<arguments.length;c++)a.push(arguments[c]);window.console.warn.call(window.console,a.join(" "))}};b.core.Base=function(){};b.core.Base.extend=function(b){var a,c,d=this;a=function(){d.apply(this,arguments);b.apply(this,arguments)};
a._parentClass=d;a._originalClass=b;for(c in d.prototype)d.prototype.hasOwnProperty(c)&&(a.prototype[c]=d.prototype[c]);for(c in b.prototype)b.prototype.hasOwnProperty(c)&&(a.prototype[c]=b.prototype[c]);for(c in d)d.hasOwnProperty(c)&&(a[c]=d[c]);for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};window.GestoJS=b})();(function(b){b.events.EventDispatcher=b.core.Base.extend(function(){var b={};this.addEventListener=function(a,c){b[a]||(b[a]=[]);b[a].push(c)};this.removeEventListener=function(a,c){var d;if(b[a]){for(d=0;d<b[a].length;d++)b[a][d]!==c&&(void 0).push(b[a][d]);b[a]=void 0}};this.dispatch=function(a){var c;if(b[a.type])for(c=0;c<b[a.type].length;c++)b[a.type][c].call(this,a)}})})(window.GestoJS);(function(b){var f=b.events;f.ON_GESTURE="onGesture";f.ON_PROGRESS="onProgress";f.ON_TRACK_PROGRESS="onTrackProgress";f.ON_TRACK_START="onTrackStart";f.ON_TRACK_COMPLETE="onTrackComplete";f.Event=function(a){this.timestamp=(new Date).getTime();this.type=a;this.sessionData=this.tracks=this.gestures=this.originalEvent=this.instance=null};f.Event.prototype.analyzeGesture=function(a){var c,d=this.instance.__getAnalyzer();a instanceof b.core.GestureList?c=a:(c=new b.core.GestureList,c.add(a));return d.analyze(this.tracks,
c)};f.Event.prototype.getHandler=function(){var a=new b.core.Handler;a.listen(this.instance);return a}})(window.GestoJS);(function(b){b.core.Handler=function(f){function a(){c.update();e=new b.core.Handler(c)}var f=f||{},c=this,d=null,e=null;this.update=function(a){d&&!a&&(a=d.__getTracks());if(!a||"function"!==typeof a.slice)throw Error("First argument must be an array of Track instances");a=a.slice();a.sort(function(a,b){return a.endTime&&!b.endTime?-1:!a.endTime&&b.endTime?1:0});a=a.slice(-2);a.sort(function(a,b){return a.startTime>b.startTime?1:-1});1===a.length?(this.x=(e?e.x:0)+a[0].offset.x,this.y=(e?e.y:0)+
a[0].offset.y):1<a.length&&(this.x=(e?e.x:0)+(a[0].offset.x+a[1].offset.x)/2,this.y=(e?e.y:0)+(a[0].offset.y+a[1].offset.y)/2,this.scale=(e?e.scale:1)*a[0].getPoint(-1).distanceTo(a[1].getPoint(-1))/a[0].getPoint(0).distanceTo(a[1].getPoint(0)),this.rotation=(e?e.rotation:0)+a[0].getPoint(-1).angleTo(a[1].getPoint(-1))-a[0].getPoint(0).angleTo(a[1].getPoint(0)))};this.listen=function(c){d=c;d.addEventListener(b.events.ON_TRACK_COMPLETE,a)};this.reset=function(a){a=a||{};e=null;this.x=a.x||0;this.y=
a.y||0;this.scale=a.scale||1;this.rotation=a.rotation||0};this.destroy=function(){d.removeEventListener(b.events.ON_TRACK_COMPLETE,a);this.reset()};this.reset(f)}})(window.GestoJS);(function(b){b.util={isTouchableDevice:function(){return-1<navigator.userAgent.indexOf("Chrome")&&!(-1<navigator.userAgent.indexOf("iOS")||-1<navigator.userAgent.indexOf("Android"))?!1:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch},isFunction:function(b){return"function"===typeof b}}})(window.GestoJS);(function(b){b.core.Analyzer=b.events.EventDispatcher.extend(function(){var f=function(a){for(var b=[],d=[],e,f,j=-1,i=0,k;i<a.length;i++){f=a[i].startTime;e=[];for(k=0;k<d.length;k++)f<d[k].endTime&&e.push(d[k]);d=e;d.length||(j++,b[j]={time:f,tracks:[]});b[j].tracks.push(a[i]);d.push(a[i])}return b};this.analyze=function(a,c){var d,e=/[a-z0-9_]+\([^\)]*\)/gi,h=[],j=f(a),i,k,l,p,n,m,o,r,g,s=c.getSorted(),q,t;q=0;for(t=s.length;q<t;q++)if(n=s[q].gestureData,n.length===j.length){for(i=k=0;i<n.length;i++)if(m=
n[i],m=m.split(/&&/g),l=m.length,r=j[i].tracks.length,r!==l)k=0;else{for(g=l=0;g<r;g++){o=0;d={tracks:a,steps:j,step:j[i],track:j[i].tracks[g]};m[g]=m[g].replace(e,function(a){var c,e;try{c=a.match(/^([^\(]+)/)[1],e=a.match(/\(([^\)]*)/)[1].split(",")}catch(f){return b.err('Parsing error in "'+a+'": '+f.toString()),0}if(!b.analyzer[c])return b.err('Undefined analyzer "'+c+'"'),0;a=j[i].tracks[g].analyze(c,[d].concat(e));o++;return a});if(!(p=eval(m[g]))){l=0;break}l+=p/o}if(!l){k=0;break}k+=l/r}k&&
h.push({name:s[q].name,points:k/n.length})}return h.length?(h.sort(function(a,b){return a.points>b.points?1:a.points<b.points?-1:0}),h):null}})})(window.GestoJS);(function(b){b.core.Gesture=function(b,a,c){this.name=b;this.priority=c||0;this.gestureData=[];"string"===typeof a&&this.gestureData.push(a);a instanceof Array&&(this.gestureData=a)}})(window.GestoJS);(function(b){b.core.Track=function(f){var a=this,c=0,d=0,e=null,h=null,j=0,i=Math.PI/2,k=2*Math.PI;this.id=f;this.points=[];this.startTime=(new Date).getTime();this.endTime=null;this.endAngle=this.startAngle=this.absoluteRotation=this.rotation=this.length=this.endSpeed=this.speed=this.duration=0;this.middle=this.offset=null;this.loops=0;this.push=function(b){this.points.push(b);var f,b=1<a.points.length?a.points[Math.max(0,a.points.length-2)]:null;f=a.points[a.points.length-1];a.speed=1E3*(a.length/
a.duration);a.offset=a.getOffset();c+=f.x;d+=f.y;a.middle=a.getMiddle();b&&(a.length+=f.distanceTo(b),f=f.angleTo(b),h>i&&f<-i&&j++,h<-i&&f>i&&j--,b=f+j*k,null!==e&&(a.rotation+=b-e,a.absoluteRotation+=Math.abs(b-e)),e=b,h=f,a.loops=Math.floor(a.rotation/k)+(0>a.rotation?1:0),a.endAngle=a.getAngle(Math.max(0,a.points.length-4),a.points.length-1),a.startAngle=a.getAngle(0,Math.min(a.points.length-1,3)),a.endSpeed=a.getSpeed())};this.end=function(){this.endTime||(this.endTime=(new Date).getTime(),this.duration=
this.endTime-this.startTime)};this.getOffset=function(){return new b.core.Point(this.points[this.points.length-1].x-this.points[0].x,this.points[this.points.length-1].y-this.points[0].y)};this.getMiddle=function(){return new b.core.Point(c/this.points.length,d/this.points.length)};this.getAngle=function(a,b){a=void 0!==a?a:Math.max(0,this.points.length-3);b=void 0!==b?b:this.points.length-1;return this.points[b].angleTo(this.points[a])};this.getSpeed=function(){return this.points[this.points.length-
1].distanceTo(this.points[Math.max(0,this.points.length-2)])/(this.points[this.points.length-1].time-this.points[Math.max(0,this.points.length-2)].time)/1E3};this.getPoint=function(a){return 0<=a?this.points[a]:this.points[this.points.length+a]};this.analyze=function(a,c){return b.analyzer[a].apply(this,c)}}})(window.GestoJS);(function(b){var f=function(a,c,d,e){this.time=(new Date).getTime();this.x=a;this.y=c;this.size=d||1;this.force=e||1;this.distanceTo=function(a){return Math.sqrt((a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y))};this.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)};this.angle=function(){return(new b.core.Point(0,0)).angleTo(this)};this.invert=function(){return new b.core.Point(-this.x,-this.y,d,e)}};f.middle=function(){var a,c=arguments,d=c[0].x,e=c[0].y;for(a=1;a<c.length;a++)d+=
c[a].x,e+=c[a].y;return new b.core.Point(d/c.length,e/c.length)};b.core.Point=f})(window.GestoJS);(function(b){b.core.Tracker=b.events.EventDispatcher.extend(function(f,a){var c=this,d=[],e={},h=0,j=b.util.isTouchableDevice(),i,k,l=function(a){var g;a.preventDefault();i&&(clearTimeout(i),i=null);d.length||(k={},g=new b.events.Event(b.events.ON_TRACK_START),g.instance=f,g.originalEvent=a,g.sessionData=k,c.dispatch(g));j?(g=a.touches[a.touches.length-1],void 0===e[g.identifier]&&(e[g.identifier]=h++,d[e[g.identifier]]=new b.core.Track(g.identifier),d[e[g.identifier]].push(new b.core.Point(g.pageX,
g.pageY)))):(d.push(new b.core.Track(d.length)),d[d.length-1].push(new b.core.Point(a.pageX,a.pageY)));g=new b.events.Event(b.events.ON_TRACK_PROGRESS);g.instance=f;g.tracks=d;g.originalEvent=a;g.sessionData=k;c.dispatch(g)},p=function(a){var g=0,h,l,m=!1;if(d.length&&!i){a.preventDefault();if(j)for(;g<a.touches.length;g++)h=a.touches[g],l=new b.core.Point(h.pageX,h.pageY),d[e[h.identifier]]&&(d[e[h.identifier]].push(l),m=!0);else l=new b.core.Point(a.pageX,a.pageY),d[d.length-1].push(l),m=!0;m&&
(g=new b.events.Event(b.events.ON_TRACK_PROGRESS),g.instance=f,g.tracks=d,g.originalEvent=a,g.sessionData=k,c.dispatch(g))}},n=function(a){var g={},h=0;if(d.length){a.preventDefault();if(!j||!a.touches.length)i=setTimeout(m,c.endGestureDelay);if(j){for(;h<a.touches.length;h++)g[a.touches[h].identifier]=!0;for(h=0;h<d.length;h++)g[e[d[h].id]]||(d[h].end(),delete e[d[h].id]);g=new b.events.Event(b.events.ON_TRACK_PROGRESS);g.instance=f;g.tracks=d;g.originalEvent=a;g.sessionData=k;c.dispatch(g)}else for(h=
0;h<d.length;h++)d[h].end()}},m=function(){var a;d.sort(function(a,b){return a.startTime>b.startTime?1:a.startTime<b.startTime?-1:0});a=new b.events.Event(b.events.ON_TRACK_COMPLETE);a.instance=f;a.tracks=d;a.sessionData=k;c.dispatch(a);d=[];e={};h=0;i=null};this.endGestureDelay=120;this.getTracks=function(){return d.slice()};try{j?(a.addEventListener("touchstart",l,!1),window.addEventListener("touchmove",p,!1),window.addEventListener("touchend",n,!1)):(a.addEventListener("mousedown",l,!1),window.addEventListener("mousemove",
p,!1),window.addEventListener("mouseup",n,!1))}catch(o){b.err(o.toString(),o)}})})(window.GestoJS);(function(b){var f=function(){this.list={}};f.prototype.add=function(a,c){var d,e,f;a instanceof b.core.Gesture&&(a.priority=c||a.priority||0,this.list[a.name]=a);if("string"===typeof a){e=a.split(",");a=[];f=[];for(d=0;d<e.length;d++)e[d].match(/\)[^\(]$/)?(f.length&&a.push(f.join(",")),f=[e[d]]):f.push(e[d]);a.push(f.join(","))}if(a instanceof Array){d=0;for(e=a.length;d<e;d++)a[d]instanceof b.core.Gesture?(a[d].priority=c||a[d].priority||0,this.list[a[d].name]=a[d]):"string"===typeof a[d]&&b.gesture[a[d]]?
this.list[a[d]]=new b.core.Gesture(a[d],b.gesture[a],c):this.list["gesture"+(d+1)]=new b.core.Gesture("gesture"+(d+1),a[d].toString(),c)}};f.prototype.remove=function(a){delete this.list[a]};f.prototype.getSorted=function(){var a=[],b;for(b in this.list)a.push(this.list[b]);a.sort(function(a,b){return a.priority>b.priority?1:b.priority>a.priority?-1:0});return a};b.core.GestureList=f})(window.GestoJS);(function(b){b.analyzer.press=function(){return 1};b.analyzer.tap=function(b,a,c){a=parseInt(a,10)||0;c=parseInt(c,10)||400;return 5>this.length&&this.duration>=a&&this.duration<c?1:0};b.analyzer.longTap=function(b,a){a=parseInt(a,10)||400;return 5>this.length&&this.duration>=a?1:0}})(window.GestoJS);(function(b){b.analyzer.pinch=function(b,a,c){var d,e,h,j,i;if(2!==b.step.tracks.length)return 0;c=parseFloat(c)/180*Math.PI||Math.PI/4;a=parseInt(a,10);d=b.step.tracks[this===b.step.tracks[0]?1:0];b=this.points[0].angleTo(d.points[0]);e=this.points[this.points.length-1].angleTo(d.points[d.points.length-1]);h=this.points[0].distanceTo(d.points[0]);j=this.points[this.points.length-1].distanceTo(d.points[d.points.length-1]);i=this.offset.angle();d=d.offset.angle();return Math.abs(Math.sin(i)+Math.sin(d))<
Math.PI/4&&Math.abs(Math.cos(i)+Math.cos(d))<Math.PI/4&&h*a>j*a&&Math.abs(b-e)<=c?1:0}})(window.GestoJS);(function(b){b.analyzer.arc=function(b,a,c){a=parseFloat(a)/180*Math.PI;c=parseFloat(c)/180*Math.PI||Math.PI/6;return this.rotation>=a-c&&this.rotation<=a+c&&20<this.length?1-Math.abs(a-this.rotation)/(2*c):0};b.analyzer.circle=function(b,a){var c,d,e=0,h=Number.MAX_VALUE,a=a||0.8;c=0;for(d=this.points.length;c<d;c++)e=Math.max(e,this.points[c].distanceTo(this.middle)),h=Math.min(h,this.points[c].distanceTo(this.middle));return Math.max(0,a-(e-h)/e)};b.analyzer.loop=function(b){return Math.abs(this.loops)===
(b||1)?1:0}})(window.GestoJS);(function(b){b.analyzer.line=function(b,a,c){a=parseFloat(a)/180*Math.PI;c=parseFloat(c)/180*Math.PI||Math.PI/6;return this.absoluteRotation<Math.PI/2&&5<this.length&&(this.endAngle>=a-c&&this.endAngle<=a+c||this.endAngle+2*Math.PI>=a-c&&this.endAngle+2*Math.PI<=a+c)?1-Math.abs(a-this.endAngle)/(2*c):0}})(window.GestoJS);(function(b){b.gesture.tap=["tap()"];b.gesture.twoTap=["tap()","tap()"];b.gesture.longTap=["longTap()"];b.gesture.twoTapLong=["tap()","longTap()"];b.gesture.doubleTap=["tap() && tap()"];b.gesture.doubleLongTap=["longTap() && longTap()"];b.gesture.twoDoubleTap=["tap() && tap()","tap() && tap()"];b.gesture.swipeLeft=["line(0)"];b.gesture.swipeRight=["line(180)"];b.gesture.swipeUp=["line(90)"];b.gesture.swipeDown=["line(-90)"];b.gesture.doubleSwipeLeft=["line(0) && line(0)"];b.gesture.doubleSwipeRight=
["line(180) && line(180)"];b.gesture.doubleSwipeUp=["line(90) && line(90)"];b.gesture.doubleSwipeDown=["line(-90) && line(-90)"];b.gesture.zoomIn=["pinch(-1) && pinch(-1)"];b.gesture.zoomOut=["pinch(1) && pinch(1)"];b.gesture.circle=["arc(400,90) * circle() || arc(-400,90) * circle()"];b.gesture.circleRight=["arc(400,90) * circle()"];b.gesture.circleLeft=["arc(-400,90) * circle()"]})(window.GestoJS);GestoJS.debug=0;
